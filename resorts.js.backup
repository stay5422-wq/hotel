// ========== Ø¥Ø¹Ø¯Ø§Ø¯ Firebase ==========
const firebaseConfig = {
    apiKey: "AIzaSyB4EXvWZUv7WvECvBC5vZP4gztXUkG9H_k",
    authDomain: "hotel-app-dce62.firebaseapp.com",
    databaseURL: "https://hotel-app-dce62-default-rtdb.firebaseio.com",
    projectId: "hotel-app-dce62",
    storageBucket: "hotel-app-dce62.firebasestorage.app",
    messagingSenderId: "645954463712",
    appId: "1:645954463712:web:acd0d977c7d85bbdd4ed85"
};

let database = null;
try {
    firebase.initializeApp(firebaseConfig);
    database = firebase.database();
    console.log('âœ… Firebase Ù…ØªØµÙ„');
} catch (error) {
    console.warn('âš ï¸ Firebase ØºÙŠØ± Ù…ØªØµÙ„');
}

// ========== Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù„Ù…Ù†ØªØ¬Ø¹Ø§Øª ÙÙŠ Ø£Ø¨Ù‡Ø§ ==========
const defaultResorts = [
    { id: 1, name: 'Ù…Ù†ØªØ¬Ø¹ Ø£Ù†Ø§Ù†ØªØ§Ø±Ø§ Ø§Ù„Ø¬Ø¨Ù„ Ø§Ù„Ø£Ø®Ø¶Ø±', address: 'Ø§Ù„Ø¬Ø¨Ù„ Ø§Ù„Ø£Ø®Ø¶Ø±ØŒ Ø£Ø¨Ù‡Ø§', phone: '+966 17 240 8888', status: 'ØªÙ… Ø§Ù„ØªØ¹Ø§Ù‚Ø¯' },
    { id: 2, name: 'Ù…Ù†ØªØ¬Ø¹ Ø§Ù„Ø³ÙˆØ¯Ø©', address: 'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø³ÙˆØ¯Ø© Ø§Ù„Ø³ÙŠØ§Ø­ÙŠØ©ØŒ Ø£Ø¨Ù‡Ø§', phone: '+966 55 444 2001', status: 'ØªÙ… Ø§Ù„ØªØ¹Ø§Ù‚Ø¯' },
    { id: 3, name: 'Ù…Ù†ØªØ¬Ø¹ Ù‚Ù…Ù… Ø§Ù„Ø³Ø±ÙˆØ§Øª', address: 'Ø·Ø±ÙŠÙ‚ Ø§Ù„Ø³ÙˆØ¯Ø©ØŒ Ø£Ø¨Ù‡Ø§', phone: '+966 55 444 2002', status: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯' },
    { id: 4, name: 'Ø´Ø§Ù„ÙŠÙ‡Ø§Øª Ø§Ù„Ù‡Ø¯Ø§', address: 'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù‡Ø¯Ø§ØŒ Ø£Ø¨Ù‡Ø§', phone: '+966 55 444 2003', status: 'ØªÙ… Ø§Ù„ØªØ¹Ø§Ù‚Ø¯' },
    { id: 5, name: 'Ù…Ù†ØªØ¬Ø¹ Ø§Ù„Ø¶Ø¨Ø§Ø¨', address: 'Ø­ÙŠ Ø§Ù„Ø¶Ø¨Ø§Ø¨ØŒ Ø£Ø¨Ù‡Ø§', phone: '+966 55 444 2004', status: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯' },
    { id: 6, name: 'Ù…Ù†ØªØ¬Ø¹ Ø£Ø¨Ù‡Ø§ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©', address: 'Ø£Ø¨Ù‡Ø§ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©ØŒ Ø£Ø¨Ù‡Ø§', phone: '+966 55 444 2005', status: 'ØªÙ… Ø§Ù„ØªØ¹Ø§Ù‚Ø¯' },
    { id: 7, name: 'Ø´Ø§Ù„ÙŠÙ‡Ø§Øª Ø§Ù„Ø­Ø¨Ù„Ø©', address: 'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø­Ø¨Ù„Ø© Ø§Ù„Ø³ÙŠØ§Ø­ÙŠØ©ØŒ Ø£Ø¨Ù‡Ø§', phone: '+966 55 444 2006', status: 'ØºÙŠØ± Ù…ØªØ¹Ø§Ù‚Ø¯' },
    { id: 8, name: 'Ù…Ù†ØªØ¬Ø¹ Ø§Ù„Ø±ÙˆØ´Ù†', address: 'Ø­ÙŠ Ø§Ù„Ø±ÙˆØ´Ù†ØŒ Ø£Ø¨Ù‡Ø§', phone: '+966 55 444 2007', status: 'ØºÙŠØ± Ù…ØªØ¹Ø§Ù‚Ø¯' },
    { id: 9, name: 'Ù…Ù†ØªØ¬Ø¹ Ø§Ù„Ø¬Ø±Ø©', address: 'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¬Ø±Ø©ØŒ Ø£Ø¨Ù‡Ø§', phone: '+966 55 444 2008', status: 'ØºÙŠØ± Ù…ØªØ¹Ø§Ù‚Ø¯' },
    { id: 10, name: 'Ø´Ø§Ù„ÙŠÙ‡Ø§Øª Ø§Ù„Ø´Ù„Ø§Ù„', address: 'Ù‚Ø±Ø¨ Ø§Ù„Ø´Ù„Ø§Ù„ØŒ Ø£Ø¨Ù‡Ø§', phone: '+966 55 444 2009', status: 'ØºÙŠØ± Ù…ØªØ¹Ø§Ù‚Ø¯' },
    { id: 11, name: 'Ù…Ù†ØªØ¬Ø¹ Ø§Ù„Ø³Ù„Ø§Ù…', address: 'Ø­ÙŠ Ø§Ù„Ø³Ù„Ø§Ù…ØŒ Ø£Ø¨Ù‡Ø§', phone: '+966 55 444 2010', status: 'ØºÙŠØ± Ù…ØªØ¹Ø§Ù‚Ø¯' },
    { id: 12, name: 'Ù…Ù†ØªØ¬Ø¹ Ø§Ù„Ø£Ù…ÙŠØ± Ø³Ù„Ø·Ø§Ù†', address: 'Ø­Ø¯ÙŠÙ‚Ø© Ø§Ù„Ø£Ù…ÙŠØ± Ø³Ù„Ø·Ø§Ù†ØŒ Ø£Ø¨Ù‡Ø§', phone: '+966 55 444 2011', status: 'ØºÙŠØ± Ù…ØªØ¹Ø§Ù‚Ø¯' },
    { id: 13, name: 'Ø´Ø§Ù„ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ù†ØªØ²Ù‡', address: 'Ù‚Ø±Ø¨ Ø§Ù„Ù…Ù†ØªØ²Ù‡ Ø§Ù„ÙˆØ·Ù†ÙŠØŒ Ø£Ø¨Ù‡Ø§', phone: '+966 55 444 2012', status: 'ØºÙŠØ± Ù…ØªØ¹Ø§Ù‚Ø¯' },
    { id: 14, name: 'Ù…Ù†ØªØ¬Ø¹ Ø§Ù„Ù‚Ø±ÙŠÙ‚Ø±', address: 'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù‚Ø±ÙŠÙ‚Ø±ØŒ Ø£Ø¨Ù‡Ø§', phone: '+966 55 444 2013', status: 'ØºÙŠØ± Ù…ØªØ¹Ø§Ù‚Ø¯' },
    { id: 15, name: 'Ø´Ø§Ù„ÙŠÙ‡Ø§Øª Ø§Ù„ÙˆØµØ§ÙŠÙ', address: 'Ø­ÙŠ Ø§Ù„ÙˆØµØ§ÙŠÙØŒ Ø£Ø¨Ù‡Ø§', phone: '+966 55 444 2014', status: 'ØºÙŠØ± Ù…ØªØ¹Ø§Ù‚Ø¯' },
    { id: 16, name: 'Ù…Ù†ØªØ¬Ø¹ Ø§Ù„Ø´ÙØ§', address: 'Ø­ÙŠ Ø§Ù„Ø´ÙØ§Ø¡ØŒ Ø£Ø¨Ù‡Ø§', phone: '+966 55 444 2015', status: 'ØºÙŠØ± Ù…ØªØ¹Ø§Ù‚Ø¯' },
    { id: 17, name: 'Ø´Ø§Ù„ÙŠÙ‡Ø§Øª Ø§Ù„Ø±Ø¨ÙˆØ©', address: 'Ø­ÙŠ Ø§Ù„Ø±Ø¨ÙˆØ©ØŒ Ø£Ø¨Ù‡Ø§', phone: '+966 55 444 2016', status: 'ØºÙŠØ± Ù…ØªØ¹Ø§Ù‚Ø¯' },
    { id: 18, name: 'Ù…Ù†ØªØ¬Ø¹ Ø§Ù„Ù†Ø®ÙŠÙ„', address: 'Ø­ÙŠ Ø§Ù„Ù†Ø®ÙŠÙ„ØŒ Ø£Ø¨Ù‡Ø§', phone: '+966 55 444 2017', status: 'ØºÙŠØ± Ù…ØªØ¹Ø§Ù‚Ø¯' },
    { id: 19, name: 'Ø´Ø§Ù„ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ¬', address: 'Ø­ÙŠ Ø§Ù„Ù…Ø±ÙˆØ¬ØŒ Ø£Ø¨Ù‡Ø§', phone: '+966 55 444 2018', status: 'ØºÙŠØ± Ù…ØªØ¹Ø§Ù‚Ø¯' },
    { id: 20, name: 'Ù…Ù†ØªØ¬Ø¹ Ø§Ù„ÙŠØ§Ø³Ù…ÙŠÙ†', address: 'Ø­ÙŠ Ø§Ù„ÙŠØ§Ø³Ù…ÙŠÙ†ØŒ Ø£Ø¨Ù‡Ø§', phone: '+966 55 444 2019', status: 'ØºÙŠØ± Ù…ØªØ¹Ø§Ù‚Ø¯' },
    { id: 21, name: 'Ø´Ø§Ù„ÙŠÙ‡Ø§Øª Ø§Ù„ÙˆØ±ÙˆØ¯', address: 'Ø­ÙŠ Ø§Ù„ÙˆØ±ÙˆØ¯ØŒ Ø£Ø¨Ù‡Ø§', phone: '+966 55 444 2020', status: 'ØºÙŠØ± Ù…ØªØ¹Ø§Ù‚Ø¯' },
    { id: 22, name: 'Ù…Ù†ØªØ¬Ø¹ Ø§Ù„Ø¨Ø³ØªØ§Ù†', address: 'Ø­ÙŠ Ø§Ù„Ø¨Ø³ØªØ§Ù†ØŒ Ø£Ø¨Ù‡Ø§', phone: '+966 55 444 2021', status: 'ØºÙŠØ± Ù…ØªØ¹Ø§Ù‚Ø¯' },
    { id: 23, name: 'Ø´Ø§Ù„ÙŠÙ‡Ø§Øª Ø§Ù„Ù†Ø¯Ù‰', address: 'Ø­ÙŠ Ø§Ù„Ù†Ø¯Ù‰ØŒ Ø£Ø¨Ù‡Ø§', phone: '+966 55 444 2022', status: 'ØºÙŠØ± Ù…ØªØ¹Ø§Ù‚Ø¯' },
    { id: 24, name: 'Ù…Ù†ØªØ¬Ø¹ Ø§Ù„Ø±ÙŠØ§Ù†', address: 'Ø­ÙŠ Ø§Ù„Ø±ÙŠØ§Ù†ØŒ Ø£Ø¨Ù‡Ø§', phone: '+966 55 444 2023', status: 'ØºÙŠØ± Ù…ØªØ¹Ø§Ù‚Ø¯' },
    { id: 25, name: 'Ø´Ø§Ù„ÙŠÙ‡Ø§Øª Ø§Ù„ØµÙØ§', address: 'Ø­ÙŠ Ø§Ù„ØµÙØ§ØŒ Ø£Ø¨Ù‡Ø§', phone: '+966 55 444 2024', status: 'ØºÙŠØ± Ù…ØªØ¹Ø§Ù‚Ø¯' }
];

let resorts = [];
let editingId = null;

// ========== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ==========
function loadResorts() {
    const saved = localStorage.getItem('resorts');
    if (saved) {
        resorts = JSON.parse(saved);
    } else {
        resorts = [...defaultResorts];
    }
    
    if (database) {
        database.ref('resorts').once('value').then(snapshot => {
            const data = snapshot.val();
            if (data && Object.keys(data).length > 0) {
                const firebaseResorts = Object.values(data);
                resorts = firebaseResorts;
                localStorage.setItem('resorts', JSON.stringify(resorts));
            } else {
                saveToFirebase();
            }
            displayResorts();
        }).catch(error => {
            console.error('Ø®Ø·Ø£ ÙÙŠ Firebase:', error);
            displayResorts();
        });
    } else {
        displayResorts();
    }
}

// ========== Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ==========
function saveResorts() {
    localStorage.setItem('resorts', JSON.stringify(resorts));
    saveToFirebase();
}

function saveToFirebase() {
    if (database) {
        const obj = {};
        resorts.forEach(r => obj[r.id] = r);
        database.ref('resorts').set(obj).catch(err => console.warn('Firebase error:', err));
    }
}

// ========== Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ==========
function displayResorts(filtered = null) {
    const tbody = document.getElementById('tableBody');
    tbody.innerHTML = '';
    
    const list = filtered || resorts;
    
    if (list.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 30px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø¹Ø§Øª</td></tr>';
        return;
    }
    
    list.forEach((resort, index) => {
        let statusClass = '';
        if (resort.status === 'ØªÙ… Ø§Ù„ØªØ¹Ø§Ù‚Ø¯') statusClass = 'status-completed';
        else if (resort.status === 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯') statusClass = 'status-inprogress';
        else if (resort.status === 'ØºÙŠØ± Ù…ØªØ¹Ø§Ù‚Ø¯') statusClass = 'status-notstarted';
        else if (resort.status === 'Ø±ÙØ¶ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯') statusClass = 'status-rejected';
        
        const searchName = encodeURIComponent(resort.name + ' Ø£Ø¨Ù‡Ø§');
        const displayPhone = resort.phone.replace('+966', '0').replace(/\s/g, '');
        
        let whatsappNumber = resort.phone.replace(/[\s\-\(\)]/g, '');
        if (whatsappNumber.startsWith('+966')) {
            whatsappNumber = whatsappNumber.replace('+966', '966');
        } else if (whatsappNumber.startsWith('00966')) {
            whatsappNumber = whatsappNumber.replace('00966', '966');
        } else if (whatsappNumber.startsWith('0')) {
            whatsappNumber = '966' + whatsappNumber.substring(1);
        }
        
        let callNumber = resort.phone.replace(/[\s\-\(\)]/g, '');
        if (callNumber.startsWith('+966')) {
            callNumber = '0' + callNumber.substring(4);
        } else if (callNumber.startsWith('00966')) {
            callNumber = '0' + callNumber.substring(5);
        }
        
        const row = `
            <tr>
                <td>${index + 1}</td>
                <td>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span>${resort.name}</span>
                        <div class="search-buttons">
                            <a href="https://www.booking.com/search.html?ss=${searchName}" target="_blank" class="btn-search" title="Ø¨Ø­Ø« ÙÙŠ Booking">ğŸ¨</a>
                            <a href="https://www.google.com/search?q=${searchName}" target="_blank" class="btn-search" title="Ø¨Ø­Ø« ÙÙŠ Google">ğŸ”</a>
                            <a href="https://www.google.com/maps/search/${searchName}" target="_blank" class="btn-search" title="ÙØªØ­ ÙÙŠ Ø§Ù„Ø®Ø±Ø§Ø¦Ø·">ğŸ“</a>
                        </div>
                    </div>
                </td>
                <td>${resort.address}</td>
                <td dir="ltr" style="text-align: center;">
                    <div class="phone-actions">
                        <span class="phone-number">${displayPhone}</span>
                        <div class="phone-buttons">
                            <a href="tel:${callNumber}" class="btn-call">ğŸ“</a>
                            <a href="https://wa.me/${whatsappNumber}" target="_blank" class="btn-whatsapp">ğŸ’¬</a>
                        </div>
                    </div>
                </td>
                <td>
                    <select class="status-select ${statusClass}" onchange="changeStatus(${resort.id}, this.value)">
                        <option value="ØªÙ… Ø§Ù„ØªØ¹Ø§Ù‚Ø¯" ${resort.status === 'ØªÙ… Ø§Ù„ØªØ¹Ø§Ù‚Ø¯' ? 'selected' : ''}>ØªÙ… Ø§Ù„ØªØ¹Ø§Ù‚Ø¯</option>
                        <option value="Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯" ${resort.status === 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯' ? 'selected' : ''}>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯</option>
                        <option value="ØºÙŠØ± Ù…ØªØ¹Ø§Ù‚Ø¯" ${resort.status === 'ØºÙŠØ± Ù…ØªØ¹Ø§Ù‚Ø¯' ? 'selected' : ''}>ØºÙŠØ± Ù…ØªØ¹Ø§Ù‚Ø¯</option>
                        <option value="Ø±ÙØ¶ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯" ${resort.status === 'Ø±ÙØ¶ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯' ? 'selected' : ''}>Ø±ÙØ¶ Ø§Ù„ØªØ¹Ø§Ù‚Ø¯</option>
                    </select>
                </td>
                <td>
                    <button class="btn-edit" onclick="editResort(${resort.id})">ØªØ¹Ø¯ÙŠÙ„</button>
                    <button class="btn-delete" onclick="deleteResort(${resort.id})">Ø­Ø°Ù</button>
                </td>
            </tr>
        `;
        tbody.innerHTML += row;
    });
}

// ========== ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø© ==========
function changeStatus(id, newStatus) {
    const resort = resorts.find(r => r.id === id);
    if (resort) {
        resort.status = newStatus;
        saveResorts();
        displayResorts();
    }
}

// ========== Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø¥Ø¶Ø§ÙØ© ÙˆØ§Ù„ØªØ¹Ø¯ÙŠÙ„ ==========
function showAddForm() {
    document.getElementById('addForm').style.display = 'block';
    document.getElementById('resortForm').reset();
    editingId = null;
}

function hideAddForm() {
    document.getElementById('addForm').style.display = 'none';
    editingId = null;
}

function showUploadForm() {
    document.getElementById('uploadForm').style.display = 'block';
}

function hideUploadForm() {
    document.getElementById('uploadForm').style.display = 'none';
}

document.getElementById('resortForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const name = document.getElementById('resortName').value;
    const address = document.getElementById('address').value;
    const phone = document.getElementById('phone').value;
    const status = document.getElementById('status').value;
    
    if (editingId) {
        const resort = resorts.find(r => r.id === editingId);
        if (resort) {
            resort.name = name;
            resort.address = address;
            resort.phone = phone;
            resort.status = status;
        }
    } else {
        const newId = resorts.length > 0 ? Math.max(...resorts.map(r => r.id)) + 1 : 1;
        resorts.push({ id: newId, name, address, phone, status });
    }
    
    saveResorts();
    displayResorts();
    hideAddForm();
});

// ========== Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­Ø°Ù ==========
function editResort(id) {
    const resort = resorts.find(r => r.id === id);
    if (resort) {
        document.getElementById('resortName').value = resort.name;
        document.getElementById('address').value = resort.address;
        document.getElementById('phone').value = resort.phone;
        document.getElementById('status').value = resort.status;
        editingId = id;
        showAddForm();
    }
}

function deleteResort(id) {
    if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬Ø¹ØŸ')) {
        resorts = resorts.filter(r => r.id !== id);
        saveResorts();
        displayResorts();
    }
}

// ========== Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙÙ„ØªØ± ==========
function filterResorts() {
    const searchValue = document.getElementById('searchInput').value.toLowerCase();
    const statusValue = document.getElementById('statusFilter').value;
    
    let filtered = resorts;
    
    if (searchValue) {
        filtered = filtered.filter(r => 
            r.name.toLowerCase().includes(searchValue) ||
            r.address.toLowerCase().includes(searchValue) ||
            r.phone.includes(searchValue)
        );
    }
    
    if (statusValue !== 'Ø§Ù„ÙƒÙ„') {
        filtered = filtered.filter(r => r.status === statusValue);
    }
    
    displayResorts(filtered);
}

function clearFilters() {
    document.getElementById('searchInput').value = '';
    document.getElementById('statusFilter').value = 'Ø§Ù„ÙƒÙ„';
    displayResorts();
}

// ========== Ø§Ù„ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel ==========
function exportToExcel() {
    const data = resorts.map((r, i) => ({
        '#': i + 1,
        'Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø¹': r.name,
        'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†': r.address,
        'Ø§Ù„Ù‡Ø§ØªÙ': r.phone,
        'Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¹Ø§Ù‚Ø¯': r.status
    }));
    
    const ws = XLSX.utils.json_to_sheet(data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'Ø§Ù„Ù…Ù†ØªØ¬Ø¹Ø§Øª');
    XLSX.writeFile(wb, 'Ø§Ù„Ù…Ù†ØªØ¬Ø¹Ø§Øª_Ø£Ø¨Ù‡Ø§.xlsx');
}

// ========== Ø±ÙØ¹ ÙˆØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ± ==========
const dropZone = document.getElementById('dropZone');
const fileInput = document.getElementById('fileInput');
const imagePreview = document.getElementById('imagePreview');
const previewImg = document.getElementById('previewImg');

dropZone.addEventListener('click', () => fileInput.click());

fileInput.addEventListener('change', handleFile);

dropZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropZone.style.borderColor = '#4CAF50';
});

dropZone.addEventListener('dragleave', () => {
    dropZone.style.borderColor = '#666';
});

dropZone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropZone.style.borderColor = '#666';
    const file = e.dataTransfer.files[0];
    if (file && file.type.startsWith('image/')) {
        displayImage(file);
    }
});

document.addEventListener('paste', (e) => {
    const items = e.clipboardData.items;
    for (let item of items) {
        if (item.type.startsWith('image/')) {
            const file = item.getAsFile();
            displayImage(file);
            showUploadForm();
        }
    }
});

function handleFile(e) {
    const file = e.target.files[0];
    if (file) displayImage(file);
}

function displayImage(file) {
    const reader = new FileReader();
    reader.onload = (e) => {
        previewImg.src = e.target.result;
        imagePreview.style.display = 'block';
    };
    reader.readAsDataURL(file);
}

function processImage() {
    Tesseract.recognize(previewImg.src, 'ara+eng', {
        logger: m => console.log(m)
    }).then(({ data: { text } }) => {
        console.log('Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬:', text);
        
        const nameMatch = text.match(/([^\n]+(?:Ù…Ù†ØªØ¬Ø¹|Ø´Ø§Ù„ÙŠÙ‡|Ø±ÙŠØ²ÙˆØ±Øª|resort)[^\n]+)/i);
        const phoneMatch = text.match(/(\+?966|05)\s*\d{1,2}\s*\d{3}\s*\d{4}/);
        
        if (nameMatch) document.getElementById('resortName').value = nameMatch[1].trim();
        if (phoneMatch) document.getElementById('phone').value = phoneMatch[0];
        
        showAddForm();
        hideUploadForm();
    });
}

// ========== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ==========
window.onload = loadResorts;
